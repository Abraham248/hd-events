<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> 
<head>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script type="text/javascript" src="/static/md5.js"></script>
<script type="text/javascript"> 
var main_screen_turn_on = false;

function capstaff(evt) { 
  var evt = (evt) ? evt : ((event) ? event : null); 
  if (evt.keyCode) code = evt.keyCode;
  else if (evt.which) code = evt.which;  
  var em = document.getElementById("em").value;  
  if (code==45 || code==18) {
    showStaffButtons();
    return false;
  }
  if (code==9 && em.length>0 && em.indexOf("@")==-1) {
    document.getElementById("em").value = em+"@hackerdojo.com";
    return false;
  }  
}

function stopRKey(evt) { 
  var evt = (evt) ? evt : ((event) ? event : null); 
  var node = (evt.target) ? evt.target : ((evt.srcElement) ? evt.srcElement : null); 
  var em = document.getElementById("em").value;
  
  if (evt.keyCode==45 || evt.keyCode==18) {
    showStaffButtons();
  }
    
  if (evt.keyCode) code = evt.keyCode;
  else if (evt.which) code = evt.which;

  if (main_screen_turn_on) {
   if (code == 49) go('Anonymous',true);
   if (code == 50) go('Member',true);
   if (code == 51) go('StaffKey',true);
   if (code == 52) cancel();
   return false;
  }
  if ((code == 13) && (node.type=="text"))  {    
    entered = document.getElementById("em").value;
    /* RFID is numeric */
    if (entered > 0) {
      document.getElementById("em").value = "";
      $('#ajaxloading').show();
      $.getJSON( 'http://signup.hackerdojo.com/api/rfid?id='+entered+'&callback=?', '',
        function (data) { 
          $('#ajaxloading').hide();
          if (data && data.username) {
            main_screen_turn_on = true;
            $('#rfidwelcome').show();
            document.getElementById("em").value = data.username + "@hackerdojo.com";
            $('.rfidpic').attr("src",data.gravatar);
            $('.rfidname').html(data.name);
            // setTimeout('auto_reset();',90000);
          } else {
            $('#denied').show();
            setTimeout("auto_reset();",3 * 1000);
          }   
        } 
      );
    }    
    return false;
  } 

} 

function cancel() {
  $('#ajaxloading').hide();
  $('#rfidwelcome').hide();
  main_screen_turn_on = false;
  document.getElementById("em").value = "";
  document.getElementById("em").focus();
}


function showStaffButtons() {
	document.getElementById("staffbuttons").style.display="block";
    setTimeout("document.getElementById('staffbuttons').style.display='none';",30*1000);
}

document.onkeypress = stopRKey; 
document.onkeydown = capstaff; 

</script>
<style>
html,body {margin:0; padding:0; height:100%; width:100%}
body {font-family:sans-serif; font-size:180%;}
input {font-size:130%; margin:.5em }
.hrow:hover {background:#88cca5; cursor:pointer}
#rfidtable td {padding:6px 12px; color:#333}
.corners {
  -webkit-border-radius: 8px;
  -moz-border-radius: 8px;
  border-radius: 8px;
}
</style>
</head>
<body onload="onl()">
<form id="f" method="post">

<div id="tos" class="corners" style="display:none; position:absolute; z-index:2; top:10%; left:10%; width:80%; height:80%; border:2px solid black; background:white ">
  <iframe style="border:none" border=0 width=100% src="http://hackerdojo.pbworks.com/api_v2/op/GetPage/page/Policies/_type/html" height=80%>
  </iframe>
  <center><input style="margin:1em" type=button onclick="ok();" value="I agree to the terms above"></center>
</div>

<div id="rfidwelcome" class="corners" style="display:none; position:absolute; z-index:2; top:05%; left:15%; width:70%; border:2px solid black; background:#baffbc; padding:1em">
  <h2 style="margin:0">Welcome <span class="rfidname">Name</span></h2>
  
  <p style="font-size:24px; margin-bottom:1em">Please choose a sign-in option.</p>
  
  <table width="80%" align="center" border="0" cellspacing="0" cellpadding="0" id="rfidtable">
  <tr class="hrow" onclick="go('Anonymous',true)">
  <td>&nbsp;</td>  
  <td width="84">
    <img height="84" width="84" src="/static/anon.png">
    </td>
    <td>
    <h3 style="margin:0">Anonymous</h3>
  </td>
  <td><input type="button" value="1" style="border:2px solid black" /></td>
  <td>&nbsp;</td>  
  </tr>
  <tr class="hrow" onclick="go('Member',true)">
  <td>&nbsp;</td>  
  <td>
    <img height="80" width="80" src="/static/anon.png" class="rfidpic" style="border:2px solid orange">
    </td>
    <td>
    <h3 style="margin:0"><span class="rfidname">Name</span></h3>
    <h4 style="margin:0">Member</h4>
  </td>
  <td><input type="button" value="2" style="border:2px solid orange" /></td>
  <td>&nbsp;</td>  
  </tr>
  <tr class="hrow" onclick="go('StaffKey',true)">
  <td>&nbsp;</td>  
  <td>
    <img height="80" width="80"  src="/static/anon.png" class="rfidpic" style="border:2px solid blue">
    </td>
    <td>
    <h3 style="margin:0"><span class="rfidname">Name</span></h3>
    <h4 style="margin:0">Acting as staff</h4>
  </td>
  <td><input type="button" value="3" style="border:2px solid blue" /></td>
  <td>&nbsp;</td>  
  </tr>
  <tr class=hrow onclick="cancel()">
  <td>&nbsp;</td>
  <td>
    <img height="84" width="84" src="/static/x.png">
    </td>
    <td>
    <h3 style="margin:0">Cancel</h3>
  </td>
  <td><input type="button" value="4" style="border:2px solid red" /></td>
  <td>&nbsp;</td>
  </tr>
  </table>
</div>

<div id="ajaxloading" class="corners" style="padding:3em; display:none; position:absolute; z-index:2; top:35%; left:35%; width:20%; border:2px solid black; background:#baffbc ">
  <center>Please Wait <img src="/static/spinny2.gif" style="margin:1em" width="54" height="55" align="absmiddle" /></center>
</div>

<div id="thanks"  class="corners" style="padding:3em; display:none; position:absolute; z-index:2; top:35%; left:35%; width:20%; border:2px solid black; background:#baffbc ">
  <center>Thank You</center>
</div>

<div id="denied" class="corners" style="padding:4em; display:none; color:black; position:absolute; z-index:2; top:35%; left:25%; width:40%; border:2px solid red; background:#faa ">
  <h1><center>Access Denied</center></h1>
</div>

<div id="privacy" class="corners" style="padding:1em; display:none; position:absolute; z-index:2; top:25%; left:25%; width:40%; border:2px solid black; background:#baffbc; font-size:80% ">
  <h2>E-mail Privacy</h2>

  <p>The Dojo will not sell, rent, or give out your e-mail address to ANYONE.</p>

  <p>The Dojo may send you a "welcome e-mail" telling you about membership, and we may contact you in the future about interesting events and other happenings (which of course, you can opt-out of).</p>

  <p>We hate spam & we're not evil ;)</p>

  <p><a href="#" onclick="document.getElementById('privacy').style.display='none'; document.getElementById('em').focus();">Close</a></p>
</div>

<center>

<img style="margin:1.5em" src="/static/logo.png" width="690" height="244" />

<h2>Please Sign In</h2>

E-mail: <input id="em" type="text" name="email">
<a style="color:green; font-size:9px" href="#" onclick="document.getElementById('privacy').style.display='block';">E-mail Privacy</a>
<br>

<input type="button" value="Member" onclick="clickmember()"/>
<input type="button" value="Guest" onclick="go('Guest')"/>
<input type="button" value="Event Attendee" onclick="go('Event')"/>

<div id="staffbuttons" style="display:none">
  <input type=button value="Staff" onclick="go('StaffKey')"/>
</div>

<input id="ttt" type="hidden" name="type" value=""/>
<script>
String.prototype.capitalize = function(){
   return this.replace( /(^|\s)([a-z])/g , function(m,p1,p2){ return p1+p2.toUpperCase(); } );
};
  
function clickmember() {
  var em = document.getElementById("em").value;  
  if (em.indexOf("@hackerdojo.com")==-1) {
    alert("That e-mail address does not match a valid @hackerdojo.com e-mail.");   
    return false;
  } else {
     main_screen_turn_on = true;
     em.value
     $('#rfidwelcome').show();
     name = em.substring(0,em.indexOf("@hackerdojo.com")).replace("."," ").capitalize();
     gravatar = "http://www.gravatar.com/avatar/" + hex_md5(em);
     $('.rfidpic').attr("src",gravatar);
     $('.rfidname').html(name);
   }  
}

function auto_reset() {
  $('#tos').hide();
  $('#thanks').hide();
  $('#denied').hide();
  $('#privacy').hide();
  $('#rfidwelcome').hide();
  $('#ajaxloading').hide();
  main_screen_turn_on = false;
  document.getElementById("ttt").value = "";
  document.getElementById("em").value = "";
  document.getElementById("em").focus();
}

function go(x,skip) {
  if (isEmail(document.getElementById("em").value)) {
    document.getElementById("ttt").value = x;
    if (skip) {
      $('#rfidwelcome').hide();
      $('#ajaxloading').show();
      main_screen_turn_on = false;
      document.getElementById("f").submit();
    } else {
      document.getElementById("tos").style.display = 'block';
      setTimeout('auto_reset()',5*60*1000);
    }
  } else {
    alert("Please enter a valid e-mail address");
  }

}
function ok() {
  document.getElementById("tos").style.display = 'none';
  document.getElementById("thanks").style.display = 'block';
  main_screen_turn_on = false;
  setTimeout('document.getElementById("f").submit();',1000);
}
var isEmail_re       = /^\s*[\w\-\+_]+(\.[\w\-\+_]+)*\@[\w\-\+_]+\.[\w\-\+_]+(\.[\w\-\+_]+)*\s*$/;
function isEmail (s) {
   return String(s).search (isEmail_re) != -1;
}
function onl() {
  document.getElementById("em").value = "";
  document.getElementById("em").focus();
}
</script>

</form>
</center>

</body>
</html>
